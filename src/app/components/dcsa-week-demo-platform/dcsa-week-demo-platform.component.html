<div class="grid">
  <div class="col-6">
    <p-card [style]='{ borderRadius: "25px", height: "100%" }'>
      <div class="grid">
        <div class="col-10 font-bold" style="font-size: 2rem">Send eBL</div>

        <div class="col-2 align-content-end justify-content-end">
          <button (click)="eblVisible = true"
                  pButton
                  appDebounceClick
                  icon="pi pi-book"
                  class="p-button-secondary">
          </button>
        </div>
      </div>

      <br>

      <div class="grid justify-content-evenly">
          <p-dropdown [(ngModel)]="platformState.receiver"
                      #receiverModel="ngModel"
                      id="receiver"
                      name="receiver"
                      placeholder="Receiver"
                      class="dropdown-80p-width"
                      [style]="{minWidth: '100%'}"
                      [ngModelOptions]="{standalone: true}"
                      [filter]="true"
                      [showClear]="true"
                      [required]="true"
                      [disabled]="platformState.hasTransferStarted"
                      [options]="selectableUsers">
            <ng-template pTemplate="item" let-item>
              {{item.name}} ({{item.platform}})
            </ng-template>
            <ng-template pTemplate="selectedItem" let-item>
              {{item.name}} ({{item.platform}})
            </ng-template>
          </p-dropdown>
      </div>
      <br>
      <div *ngIf="!platformState.hasTransferStarted" class="flex justify-content-evenly">
        <button label="Transfer"
                pButton
                appDebounceClick
                class="p-button-rounded"
                [style]="{width: '80%'}"
                [disabled]="!receiverModel.valid"
                [loading]="platformState.hasTransferStarted"
                (debounceClick)="initiateTransfer()"
                icon="pi pi-send">
        </button>
      </div>
      <div *ngIf="platformState.hasTransferStarted">
        <div class="grid">
          <div class="col-1">&nbsp;</div>
          <!--
              The icon cannot be change dynamically for some reason. Quick fix,
              add a button per case. It is a lot more convoluted than desired,
              but c'est la vie when there is a deadline.
          -->
          <div class="col-1">
            <button pButton
                    class="p-button-rounded p-button-sm"
                    [disabled]="true"
                    [class.transfer-accepted]="platformState.isTransferAccepted"
                    [class.transfer-rejected]="platformState.isTransferRejected"
                    [class.transfer-disputed]="platformState.isTransferDisputed"
                    *ngIf="!platformState.isTransferInProgress"
                    icon="pi {{transferIcon}}">
            </button>
            <p-progressSpinner *ngIf="platformState.isTransferInProgress"
                               [style]="{ height: '1.7rem', width: '1.7rem' }">
            </p-progressSpinner>

          </div>

          <div [ngSwitch]="platformState.transferState" class="col-10">
            <ng-container *ngSwitchCase="'STARTED'">Transfer in progress</ng-container>
            <ng-container *ngSwitchCase="'ACCEPTED'">Transfer successfully</ng-container>
            <ng-container *ngSwitchCase="'REJECTED'">Transfer was rejected</ng-container>
            <ng-container *ngSwitchCase="'DISPUTED'">Transfer was disputed</ng-container>
            <ng-container *ngSwitchDefault>Bug (missing case for {{platformState.transferState}})</ng-container>
          </div>

        </div>
        <div class="grid">
          <div class="col-1">&nbsp;</div>
          <div class="col-10">
            <p-progressBar [value]="platformState.isTransferComplete ? 100 : 50"
                           [showValue]="false"
                           [color]="transferProgressBarColor">
            </p-progressBar>
          </div>
          <div class="col-1">&nbsp;</div>
        </div>
        <div *ngIf="platformState.isTransferComplete" class="flex justify-content-evenly">
          <button label="New transfer"
                  pButton
                  appDebounceClick
                  [style]="{width: '80%'}"
                  (debounceClick)="platformState.transferState = 'NOT STARTED'"
                  icon="pi pi-send">
          </button>
        </div>
      </div>
    </p-card>
  </div>

  <div class="col-6">
    <ng-template #noTransfer>
      <p-card [style]='{ borderRadius: "25px", height: "100%", opacity: 0.3 }'>
        <div class="grid">
          <div class="col-10 font-bold" style="font-size: 2rem">No incoming eBL</div>

          <div class="col-2 align-content-end justify-content-end">
            <button (click)="eblVisible = true"
                    [disabled]="true"
                    pButton
                    appDebounceClick
                    icon="pi pi-book"
                    class="p-button-secondary">
            </button>
          </div>
        </div>
        <br>
        <br>
        <div class="flex justify-content-center">
          <button label="Accept"
                  pButton
                  appDebounceClick
                  class="p-button-rounded accept-button"
                  [disabled]="true"
                  (debounceClick)="acceptTransfer()"
                  icon="pi pi-check">
          </button>

          <button label="Reject"
                  pButton
                  appDebounceClick
                  class="p-button-rounded reject-button"
                  [disabled]="true"
                  (debounceClick)="rejectRecord()"
                  icon="pi pi-times">
          </button>

          <button label="Dispute"
                  pButton
                  appDebounceClick
                  class="p-button-rounded dispute-button"
                  [disabled]="true"
                  (debounceClick)="disputeRecord()"
                  icon="pi pi-exclamation-triangle">
          </button>
        </div>
      </p-card>
    </ng-template>
    <p-card *ngIf="incomingTransfer as transfer; else noTransfer" [style]='{ borderRadius: "25px", height: "100%" }'>
      <div class="grid">
        <div class="col-10 font-bold" style="font-size: 2rem">Receiving eBL (<abbr title="{{eblChecksum}}">{{eblChecksum | slice:0:7}}</abbr>) from {{transfer.fromPlatform.platform}}</div>

        <div class="col-2 align-content-end justify-content-end">
          <button (click)="eblVisible = true"
                  pButton
                  appDebounceClick
                  icon="pi pi-book"
                  class="p-button-secondary">
          </button>
        </div>
      </div>
      <br>
      <br>
      <div class="flex justify-content-center">
        <button label="Accept"
                pButton
                appDebounceClick
                class="p-button-rounded accept-button"
                (debounceClick)="acceptTransfer()"
                icon="pi pi-check">
        </button>

        <button label="Reject"
                pButton
                appDebounceClick
                class="p-button-rounded reject-button"
                (debounceClick)="rejectRecord()"
                icon="pi pi-times">
        </button>

        <button label="Dispute"
                pButton
                appDebounceClick
                class="p-button-rounded dispute-button"
                (debounceClick)="disputeRecord()"
                icon="pi pi-exclamation-triangle">
        </button>
      </div>
    </p-card>
  </div>
</div>

<p-dialog header="Sample rendering of EBL" [modal]="true" [(visible)]="eblVisible" [style]="{ width: '80%' }">
  <app-render-dcsa-ebl [ebl]="ebl">
  </app-render-dcsa-ebl>
</p-dialog>

<p-toast key="GenericSuccessToast" position="bottom-right"></p-toast>
<p-toast key="GenericErrorToast" position="bottom-right"></p-toast>
